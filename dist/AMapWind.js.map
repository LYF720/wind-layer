{"version":3,"file":"AMapWind.js","sources":["../src/windy/windy.js","../src/helper/index.js","../src/amap/index.js"],"sourcesContent":["/* eslint-disable */\r\n\r\n\r\n/*  Global class for simulating the movement of particle through a 1km wind grid\r\n credit: All the credit for this work goes to: https://github.com/cambecc for creating the repo:\r\n https://github.com/cambecc/earth. The majority of this code is directly take nfrom there, since its awesome.\r\n This class takes a canvas element and an array of data (1km GFS from http://www.emc.ncep.noaa.gov/index.php?branch=GFS)\r\n and then uses a mercator (forward/reverse) projection to correctly map wind vectors in \"map space\".\r\n The \"start\" method takes the bounds of the map at its current extent and starts the whole gridding,\r\n interpolation and animation process.\r\n */\r\n\r\nconst Windy = function (params) {\r\n  if (!params.projection) params.projection = 'EPSG:4326';\r\n  const MIN_VELOCITY_INTENSITY = params.minVelocity || 0;                      // velocity at which particle intensity is minimum (m/s)\r\n  const MAX_VELOCITY_INTENSITY = params.maxVelocity || 10;                     // velocity at which particle intensity is maximum (m/s)\r\n  const VELOCITY_SCALE = (params.velocityScale || 0.005) * (Math.pow(window.devicePixelRatio, 1 / 3) || 1); // scale for wind velocity (completely arbitrary--this value looks nice)\r\n  const MAX_PARTICLE_AGE = params.particleAge || 90;                         \t // max number of frames a particle is drawn before regeneration\r\n  const PARTICLE_LINE_WIDTH = params.lineWidth || 1;                           // line width of a drawn particle\r\n  const PARTICLE_MULTIPLIER = params.particleMultiplier || 1 / 300;            // particle count scalar (completely arbitrary--this values looks nice)\r\n  const PARTICLE_REDUCTION = (Math.pow(window.devicePixelRatio, 1 / 3) || 1.6);   // multiply particle count for mobiles by this amount\r\n  const FRAME_RATE = params.frameRate || 15, FRAME_TIME = 1000 / FRAME_RATE;   // desired frames per second\r\n\r\n  var defaulColorScale = [\r\n    \"rgb(36,104, 180)\",\r\n    \"rgb(60,157, 194)\",\r\n    \"rgb(128,205,193 )\",\r\n    \"rgb(151,218,168 )\",\r\n    \"rgb(198,231,181)\",\r\n    \"rgb(238,247,217)\",\r\n    \"rgb(255,238,159)\",\r\n    \"rgb(252,217,125)\",\r\n    \"rgb(255,182,100)\",\r\n    \"rgb(252,150,75)\",\r\n    \"rgb(250,112,52)\",\r\n    \"rgb(245,64,32)\",\r\n    \"rgb(237,45,28)\",\r\n    \"rgb(220,24,32)\",\r\n    \"rgb(180,0,35)\"\r\n  ];\r\n\r\n  const colorScale = params.colorScale || defaulColorScale;\r\n\r\n  var NULL_WIND_VECTOR = [NaN, NaN, null];  // singleton for no wind in the form: [u, v, magnitude]\r\n\r\n  var builder;\r\n  var grid;\r\n  var gridData = params.data;\r\n  var date;\r\n  var λ0, φ0, Δλ, Δφ, ni, nj;\r\n\r\n  var setData = function (data) {\r\n    gridData = data;\r\n  };\r\n\r\n  // interpolation for vectors like wind (u,v,m)\r\n  var bilinearInterpolateVector = function (x, y, g00, g10, g01, g11) {\r\n    var rx = (1 - x);\r\n    var ry = (1 - y);\r\n    var a = rx * ry, b = x * ry, c = rx * y, d = x * y;\r\n    var u = g00[0] * a + g10[0] * b + g01[0] * c + g11[0] * d;\r\n    var v = g00[1] * a + g10[1] * b + g01[1] * c + g11[1] * d;\r\n    return [u, v, Math.sqrt(u * u + v * v)];\r\n  };\r\n\r\n\r\n  var createWindBuilder = function (uComp, vComp) {\r\n    var uData = uComp.data, vData = vComp.data;\r\n    return {\r\n      header: uComp.header,\r\n      //recipe: recipeFor(\"wind-\" + uComp.header.surface1Value),\r\n      data: function (i) {\r\n        return [uData[i], vData[i]];\r\n      },\r\n      interpolate: bilinearInterpolateVector\r\n    }\r\n  };\r\n\r\n  var createBuilder = function (data) {\r\n    var uComp = null, vComp = null, scalar = null;\r\n\r\n    data.forEach(function (record) {\r\n      switch (record.header.parameterCategory + \",\" + record.header.parameterNumber) {\r\n        case \"1,2\":\r\n        case \"2,2\":\r\n          uComp = record;\r\n          break;\r\n        case \"1,3\":\r\n        case \"2,3\":\r\n          vComp = record;\r\n          break;\r\n        default:\r\n          scalar = record;\r\n      }\r\n    });\r\n\r\n    return createWindBuilder(uComp, vComp);\r\n  };\r\n\r\n  var buildGrid = function (data, callback) {\r\n\r\n    builder = createBuilder(data);\r\n    var header = builder.header;\r\n\r\n    λ0 = header.lo1;\r\n    φ0 = Math.max(header.la2, header.la1);  // the grid's origin (e.g., 0.0E, 90.0N)\r\n\r\n    Δλ = header.dx;\r\n    Δφ = header.dy;    // distance between grid points (e.g., 2.5 deg lon, 2.5 deg lat)\r\n\r\n    ni = header.nx;\r\n    nj = header.ny;    // number of grid points W-E and N-S (e.g., 144 x 73)\r\n\r\n    date = new Date(header.refTime);\r\n    date.setHours(date.getHours() + header.forecastTime);\r\n\r\n    // Scan mode 0 assumed. Longitude increases from λ0, and latitude decreases from φ0.\r\n    // http://www.nco.ncep.noaa.gov/pmb/docs/grib2/grib2_table3-4.shtml\r\n    grid = [];\r\n    var p = 0;\r\n    var isContinuous = Math.floor(ni * Δλ) >= 360;\r\n\r\n    for (var j = 0; j < nj; j++) {\r\n      var row = [];\r\n      for (var i = 0; i < ni; i++, p++) {\r\n        row[i] = builder.data(p);\r\n      }\r\n      if (isContinuous) {\r\n        // For wrapped grids, duplicate first column as last column to simplify interpolation logic\r\n        row.push(row[0]);\r\n      }\r\n      grid[j] = row;\r\n    }\r\n\r\n    callback({\r\n      date: date,\r\n      interpolate: interpolate\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Get interpolated grid value from Lon/Lat position\r\n   * @param λ {Float} Longitude\r\n   * @param φ {Float} Latitude\r\n   * @returns {Object}\r\n   */\r\n  var interpolate = function (λ, φ) {\r\n\r\n    if (!grid) return null;\r\n\r\n    var i = floorMod(λ - λ0, 360) / Δλ;  // calculate longitude index in wrapped range [0, 360)\r\n    var j = (φ0 - φ) / Δφ;                 // calculate latitude index in direction +90 to -90\r\n\r\n    var fi = Math.floor(i), ci = fi + 1;\r\n    var fj = Math.floor(j), cj = fj + 1;\r\n\r\n    var row;\r\n    if ((row = grid[fj])) {\r\n      var g00 = row[fi];\r\n      var g10 = row[ci];\r\n      if (isValue(g00) && isValue(g10) && (row = grid[cj])) {\r\n        var g01 = row[fi];\r\n        var g11 = row[ci];\r\n        if (isValue(g01) && isValue(g11)) {\r\n          // All four points found, so interpolate the value.\r\n          return builder.interpolate(i - fi, j - fj, g00, g10, g01, g11);\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n\r\n  /**\r\n   * @returns {Boolean} true if the specified value is not null and not undefined.\r\n   */\r\n  var isValue = function (x) {\r\n    return x !== null && x !== undefined;\r\n  };\r\n\r\n  /**\r\n   * @returns {Number} returns remainder of floored division, i.e., floor(a / n). Useful for consistent modulo\r\n   *          of negative numbers. See http://en.wikipedia.org/wiki/Modulo_operation.\r\n   */\r\n  var floorMod = function (a, n) {\r\n    return a - n * Math.floor(a / n);\r\n  };\r\n\r\n  /**\r\n   * @returns {Number} the value x clamped to the range [low, high].\r\n   */\r\n  var clamp = function (x, range) {\r\n    return Math.max(range[0], Math.min(x, range[1]));\r\n  };\r\n\r\n  /**\r\n   * @returns {Boolean} true if agent is probably a mobile device. Don't really care if this is accurate.\r\n   */\r\n  var isMobile = function () {\r\n    return (/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i).test(navigator.userAgent);\r\n  };\r\n\r\n  /**\r\n   * Calculate distortion of the wind vector caused by the shape of the projection at point (x, y). The wind\r\n   * vector is modified in place and returned by this function.\r\n   */\r\n  var distort = function (projection, λ, φ, x, y, scale, wind, windy) {\r\n    var u = wind[0] * scale;\r\n    var v = wind[1] * scale;\r\n    var d = distortion(projection, λ, φ, x, y, windy);\r\n\r\n    // Scale distortion vectors by u and v, then add.\r\n    wind[0] = d[0] * u + d[2] * v;\r\n    wind[1] = d[1] * u + d[3] * v;\r\n    return wind;\r\n  };\r\n\r\n  var distortion = function (projection, λ, φ, x, y, windy) {\r\n    var τ = 2 * Math.PI;\r\n    // var H = Math.pow(10, -5.2);\r\n    var H = params.projection === 'EPSG:4326' ? 5 : Math.pow(10, -5.2);\r\n    var hλ = λ < 0 ? H : -H;\r\n    var hφ = φ < 0 ? H : -H;\r\n\r\n    var pλ = project(φ, λ + hλ, windy);\r\n    var pφ = project(φ + hφ, λ, windy);\r\n\r\n    // Meridian scale factor (see Snyder, equation 4-3), where R = 1. This handles issue where length of 1º λ\r\n    // changes depending on φ. Without this, there is a pinching effect at the poles.\r\n    var k = Math.cos(φ / 360 * τ);\r\n    return [\r\n      (pλ[0] - x) / hλ / k,\r\n      (pλ[1] - y) / hλ / k,\r\n      (pφ[0] - x) / hφ,\r\n      (pφ[1] - y) / hφ\r\n    ];\r\n  };\r\n\r\n  var createField = function (columns, bounds, callback) {\r\n\r\n    /**\r\n     * @returns {Array} wind vector [u, v, magnitude] at the point (x, y), or [NaN, NaN, null] if wind\r\n     *          is undefined at that point.\r\n     */\r\n    function field (x, y) {\r\n      var column = columns[Math.round(x)];\r\n      return column && column[Math.round(y)] || NULL_WIND_VECTOR;\r\n    }\r\n\r\n    // Frees the massive \"columns\" array for GC. Without this, the array is leaked (in Chrome) each time a new\r\n    // field is interpolated because the field closure's context is leaked, for reasons that defy explanation.\r\n    field.release = function () {\r\n      columns = [];\r\n    };\r\n\r\n    field.randomize = function (o) {  // UNDONE: this method is terrible\r\n      var x, y;\r\n      var safetyNet = 0;\r\n      do {\r\n        x = Math.round(Math.floor(Math.random() * bounds.width) + bounds.x);\r\n        y = Math.round(Math.floor(Math.random() * bounds.height) + bounds.y)\r\n      } while (field(x, y)[2] === null && safetyNet++ < 30);\r\n      o.x = x;\r\n      o.y = y;\r\n      return o;\r\n    };\r\n\r\n    callback(bounds, field);\r\n  };\r\n\r\n  var buildBounds = function (bounds, width, height) {\r\n    var upperLeft = bounds[0];\r\n    var lowerRight = bounds[1];\r\n    var x = Math.round(upperLeft[0]); //Math.max(Math.floor(upperLeft[0], 0), 0);\r\n    var y = Math.max(Math.floor(upperLeft[1], 0), 0);\r\n    var xMax = Math.min(Math.ceil(lowerRight[0], width), width - 1);\r\n    var yMax = Math.min(Math.ceil(lowerRight[1], height), height - 1);\r\n    return {x: x, y: y, xMax: width, yMax: yMax, width: width, height: height};\r\n  };\r\n\r\n  var deg2rad = function (deg) {\r\n    return (deg / 180) * Math.PI;\r\n  };\r\n\r\n  var rad2deg = function (ang) {\r\n    return ang / (Math.PI / 180.0);\r\n  };\r\n\r\n  var invert\r\n\r\n  if (params.projection === 'EPSG:4326') {\r\n    invert = function (x, y, windy) {\r\n      var mapLonDelta = windy.east - windy.west;\r\n      var mapLatDelta = windy.south - windy.north;\r\n      var lat = rad2deg(windy.north) + y / windy.height * rad2deg(mapLatDelta);\r\n      var lon = rad2deg(windy.west) + x / windy.width * rad2deg(mapLonDelta);\r\n      return [lon, lat];\r\n    };\r\n  } else {\r\n    invert = function (x, y, windy) {\r\n      var mapLonDelta = windy.east - windy.west;\r\n      var worldMapRadius = windy.width / rad2deg(mapLonDelta) * 360 / (2 * Math.PI);\r\n      var mapOffsetY = (worldMapRadius / 2 * Math.log((1 + Math.sin(windy.south)) / (1 - Math.sin(windy.south))));\r\n      var equatorY = windy.height + mapOffsetY;\r\n      var a = (equatorY - y) / worldMapRadius;\r\n      var lat = 180 / Math.PI * (2 * Math.atan(Math.exp(a)) - Math.PI / 2);\r\n      var lon = rad2deg(windy.west) + x / windy.width * rad2deg(mapLonDelta);\r\n      return [lon, lat];\r\n    };\r\n  }\r\n\r\n  var mercY = function (lat) {\r\n    return Math.log(Math.tan(lat / 2 + Math.PI / 4));\r\n  };\r\n\r\n\r\n  var project = function (lat, lon, windy) { // both in radians, use deg2rad if neccessary\r\n    var ymin = mercY(windy.south);\r\n    var ymax = mercY(windy.north);\r\n    var xFactor = windy.width / (windy.east - windy.west);\r\n    var yFactor = windy.height / (ymax - ymin);\r\n\r\n    var y = mercY(deg2rad(lat));\r\n    var x = (deg2rad(lon) - windy.west) * xFactor;\r\n    var y = (ymax - y) * yFactor; // y points south\r\n    return [x, y];\r\n  };\r\n\r\n  var interpolateField = function (grid, bounds, extent, callback) {\r\n\r\n    var projection = {};\r\n    var mapArea = ((extent.south - extent.north) * (extent.west - extent.east));\r\n    var velocityScale = VELOCITY_SCALE * Math.pow(mapArea, 0.4);\r\n\r\n    var columns = [];\r\n    var x = bounds.x;\r\n\r\n    function interpolateColumn (x) {\r\n      var column = [];\r\n      for (var y = bounds.y; y <= bounds.yMax; y += 2) {\r\n        var coord = invert(x, y, extent);\r\n        if (coord) {\r\n          var λ = coord[0], φ = coord[1];\r\n          if (isFinite(λ)) {\r\n            var wind = grid.interpolate(λ, φ);\r\n            if (wind) {\r\n              wind = distort(projection, λ, φ, x, y, velocityScale, wind, extent);\r\n              column[y + 1] = column[y] = wind;\r\n\r\n            }\r\n          }\r\n        }\r\n      }\r\n      columns[x + 1] = columns[x] = column;\r\n    }\r\n\r\n    (function batchInterpolate () {\r\n      var start = Date.now();\r\n      while (x < bounds.width) {\r\n        interpolateColumn(x);\r\n        x += 2;\r\n        if ((Date.now() - start) > 1000) { //MAX_TASK_TIME) {\r\n          setTimeout(batchInterpolate, 25);\r\n          return;\r\n        }\r\n      }\r\n      createField(columns, bounds, callback);\r\n    })();\r\n  };\r\n\r\n  var animationLoop;\r\n  var animate = function (bounds, field) {\r\n\r\n    function windIntensityColorScale (min, max) {\r\n\r\n      colorScale.indexFor = function (m) {  // map velocity speed to a style\r\n        return Math.max(0, Math.min((colorScale.length - 1),\r\n          Math.round((m - min) / (max - min) * (colorScale.length - 1))));\r\n\r\n      };\r\n\r\n      return colorScale;\r\n    }\r\n\r\n    var colorStyles = windIntensityColorScale(MIN_VELOCITY_INTENSITY, MAX_VELOCITY_INTENSITY);\r\n    var buckets = colorStyles.map(function () {\r\n      return [];\r\n    });\r\n\r\n    var particleCount = Math.round(bounds.width * bounds.height * PARTICLE_MULTIPLIER);\r\n    if (isMobile()) {\r\n      particleCount *= PARTICLE_REDUCTION;\r\n    }\r\n\r\n    var fadeFillStyle = \"rgba(0, 0, 0, 0.97)\";\r\n\r\n    var particles = [];\r\n    for (var i = 0; i < particleCount; i++) {\r\n      particles.push(field.randomize({age: Math.floor(Math.random() * MAX_PARTICLE_AGE) + 0}));\r\n    }\r\n\r\n    function evolve () {\r\n      buckets.forEach(function (bucket) {\r\n        bucket.length = 0;\r\n      });\r\n      particles.forEach(function (particle) {\r\n        if (particle.age > MAX_PARTICLE_AGE) {\r\n          field.randomize(particle).age = 0;\r\n        }\r\n        var x = particle.x;\r\n        var y = particle.y;\r\n        var v = field(x, y);  // vector at current position\r\n        var m = v[2];\r\n        if (m === null) {\r\n          particle.age = MAX_PARTICLE_AGE;  // particle has escaped the grid, never to return...\r\n        }\r\n        else {\r\n          var xt = x + v[0];\r\n          var yt = y + v[1];\r\n          if (field(xt, yt)[2] !== null) {\r\n            // Path from (x,y) to (xt,yt) is visible, so add this particle to the appropriate draw bucket.\r\n            particle.xt = xt;\r\n            particle.yt = yt;\r\n            buckets[colorStyles.indexFor(m)].push(particle);\r\n          }\r\n          else {\r\n            // Particle isn't visible, but it still moves through the field.\r\n            particle.x = xt;\r\n            particle.y = yt;\r\n          }\r\n        }\r\n        particle.age += 1;\r\n      });\r\n    }\r\n\r\n    var g = params.canvas.getContext(\"2d\");\r\n    g.lineWidth = PARTICLE_LINE_WIDTH;\r\n    g.fillStyle = fadeFillStyle;\r\n    g.globalAlpha = 0.6;\r\n\r\n    function draw () {\r\n      // Fade existing particle trails.\r\n      var prev = \"lighter\";\r\n      g.globalCompositeOperation = \"destination-in\";\r\n      g.fillRect(bounds.x, bounds.y, bounds.width, bounds.height);\r\n      g.globalCompositeOperation = prev;\r\n      g.globalAlpha = 0.9;\r\n\r\n      // Draw new particle trails.\r\n      buckets.forEach(function (bucket, i) {\r\n        if (bucket.length > 0) {\r\n          g.beginPath();\r\n          g.strokeStyle = colorStyles[i];\r\n          bucket.forEach(function (particle) {\r\n            g.moveTo(particle.x, particle.y);\r\n            g.lineTo(particle.xt, particle.yt);\r\n            particle.x = particle.xt;\r\n            particle.y = particle.yt;\r\n          });\r\n          g.stroke();\r\n        }\r\n      });\r\n    }\r\n\r\n    var then = Date.now();\r\n    (function frame () {\r\n      animationLoop = requestAnimationFrame(frame);\r\n      var now = Date.now();\r\n      var delta = now - then;\r\n      if (delta > FRAME_TIME) {\r\n        then = now - (delta % FRAME_TIME);\r\n        evolve();\r\n        draw();\r\n      }\r\n    })();\r\n  };\r\n\r\n  var updateData = function (data, bounds, width, height, extent) {\r\n    delete params.data;\r\n    params.data = data;\r\n    if (extent)\r\n      start(bounds, width, height, extent);\r\n  };\r\n\r\n  var start = function (bounds, width, height, extent) {\r\n    var mapBounds = {\r\n      south: deg2rad(extent[0][1]),\r\n      north: deg2rad(extent[1][1]),\r\n      east: deg2rad(extent[1][0]),\r\n      west: deg2rad(extent[0][0]),\r\n      width: width,\r\n      height: height\r\n    };\r\n\r\n    stop();\r\n\r\n    // build grid\r\n    buildGrid(gridData, function (grid) {\r\n      // interpolateField\r\n      interpolateField(grid, buildBounds(bounds, width, height), mapBounds, function (bounds, field) {\r\n        // animate the canvas with random points\r\n        windy.field = field;\r\n        animate(bounds, field);\r\n      });\r\n\r\n    });\r\n  };\r\n\r\n  var stop = function () {\r\n    if (windy.field) windy.field.release();\r\n    if (animationLoop) cancelAnimationFrame(animationLoop);\r\n  };\r\n\r\n  var shift = function (dx, dy) {\r\n    var canvas = params.canvas, w = canvas.width, h = canvas.height, ctx = canvas.getContext(\"2d\");\r\n    if (w > dx && h > dy) {\r\n      var clamp = function (high, value) {\r\n        return Math.max(0, Math.min(high, value));\r\n      };\r\n      var imageData = ctx.getImageData(clamp(w, -dx), clamp(h, -dy), clamp(w, w - dx), clamp(h, h - dy));\r\n      ctx.clearRect(0, 0, w, h);\r\n      ctx.putImageData(imageData, clamp(w, dx), clamp(h, dy));\r\n      for (var i = 0, pLength = particles.length; i < pLength; i++) {\r\n        particles[i].x += dx;\r\n        particles[i].y += dy;\r\n      }\r\n    }\r\n  };\r\n\r\n  var windy = {\r\n    params: params,\r\n    start: start,\r\n    stop: stop,\r\n    update: updateData,\r\n    shift: shift,\r\n    createField: createField,\r\n    interpolatePoint: interpolate,\r\n    setData: setData\r\n  };\r\n\r\n  return windy;\r\n};\r\n\r\n// polyfill\r\nwindow.requestAnimationFrame = (function () {\r\n  return window.requestAnimationFrame ||\r\n    window.webkitRequestAnimationFrame ||\r\n    window.mozRequestAnimationFrame ||\r\n    window.oRequestAnimationFrame ||\r\n    window.msRequestAnimationFrame ||\r\n    function (callback) {\r\n      return window.setTimeout(callback, 1000 / FRAME_RATE);\r\n    };\r\n})();\r\n\r\nif (!window.cancelAnimationFrame) {\r\n  window.cancelAnimationFrame = function (id) {\r\n    clearTimeout(id);\r\n  };\r\n}\r\n\r\nexport default Windy\r\n","/**\n * create canvas\n * @param width\n * @param height\n * @param Canvas\n * @returns {HTMLCanvasElement}\n */\nconst createCanvas = (width, height, Canvas) => {\n  if (typeof document !== 'undefined') {\n    const canvas = document.createElement('canvas');\n    canvas.width = width;\n    canvas.height = height;\n    return canvas\n  } else {\n    // create a new canvas instance in node.js\n    // the canvas class needs to have a default constructor without any parameter\n    return new Canvas(width, height);\n  }\n};\n\nconst getDirection = (uMs, vMs, angleConvention) => {\n  // Default angle convention is CW\n  if (angleConvention.endsWith('CCW')) {\n    // vMs comes out upside-down..\n    vMs = vMs > 0 ? vMs = -vMs : Math.abs(vMs);\n  }\n  const velocityAbs = Math.sqrt(Math.pow(uMs, 2) + Math.pow(vMs, 2));\n  const velocityDir = Math.atan2(uMs / velocityAbs, vMs / velocityAbs);\n  let velocityDirToDegrees = velocityDir * 180 / Math.PI + 180;\n  if (angleConvention === 'bearingCW' || angleConvention === 'meteoCCW') {\n    velocityDirToDegrees += 180;\n    if (velocityDirToDegrees >= 360) velocityDirToDegrees -= 360;\n  }\n  return velocityDirToDegrees;\n};\n\nconst getSpeed = (uMs, vMs, unit) => {\n  const velocityAbs = Math.sqrt(Math.pow(uMs, 2) + Math.pow(vMs, 2));\n  // Default is m/s\n  if (unit === 'k/h') {\n    return meterSec2kilometerHour(velocityAbs);\n  } else if (unit === 'kt') {\n    return meterSec2Knots(velocityAbs);\n  } else {\n    return velocityAbs;\n  }\n};\n\nconst meterSec2Knots = (meters) => {\n  return meters / 0.514\n};\n\nconst meterSec2kilometerHour = (meters) => {\n  return meters * 3.6\n};\n\nconst getExtent = (coords) => {\n  const extent = [\n    Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY,\n    Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY\n  ];\n  return coords.reduce((prev, coord) => {\n    return [\n      Math.min(coord[0], prev[0]),\n      Math.min(coord[1], prev[1]),\n      Math.max(coord[0], prev[2]),\n      Math.max(coord[1], prev[3])\n    ];\n  }, extent);\n}\n\nexport {\n  getExtent,\n  getSpeed,\n  createCanvas,\n  getDirection\n}\n","import Windy from '../windy/windy';\nimport { createCanvas, getDirection, getSpeed, getExtent } from '../helper';\n\nconst global = typeof window === 'undefined' ? {} : window;\nconst AMap = global.AMap || {};\n\nclass AMapWind {\n  constructor (data, options = {}) {\n    this.options = options;\n\n    /**\n     * internal\n     * @type {null}\n     */\n    this.canvas = null;\n\n    /**\n     * windy 数据\n     */\n    this.data = data;\n\n    /**\n     * canvas layer\n     * @type {null}\n     * @private\n     */\n    this.layer_ = null;\n\n    /**\n     * windy layer\n     * @type {null}\n     */\n    this._windy = null;\n\n    if (options.map) {\n      this.appendTo(options.map)\n    }\n\n    /**\n     * bind context\n     * @type {{new(...args: any[][]): any} | ((...args: any[][]) => any) | ((...args: any[]) => any) | any | {new(...args: any[]): any}}\n     */\n    this.init = this.init.bind(this);\n    this.handleResize = this.handleResize.bind(this);\n    this.canvasFunction = this.canvasFunction.bind(this);\n    this._addReFreshHandle = this._addReFreshHandle.bind(this);\n  }\n\n  /**\n   * append layer to map\n   * @param map\n   */\n  appendTo (map) {\n    if (map) {\n      this.init(map)\n    } else {\n      throw new Error('not map object');\n    }\n  }\n\n  /**\n   * get layer data\n   * @returns {*}\n   */\n  getData () {\n    return this.data;\n  }\n\n  /**\n   * set data\n   * @param data\n   */\n  setData (data) {\n    this.data = data;\n    if (this.map && this.canvas && this.data) {\n      this.render();\n    }\n  }\n\n  /**\n   * init windy layer\n   * @param map\n   * @param options\n   */\n  init (map, options) {\n    if (map) {\n      this.map = map;\n      this.context = this.options.context || '2d';\n      this.getCanvasLayer();\n      this.map.on('resize', this.handleResize, this)\n    } else {\n      throw new Error('not map object')\n    }\n  }\n\n  handleResize () {\n    if (this.canvas) {\n      this.canvasFunction()\n    }\n  }\n\n  /**\n   *  render layer\n   * @param canvas\n   * @returns {*}\n   */\n  render (canvas) {\n    if (!canvas) return;\n    const extent = this._getExtent();\n    if (!this.getData() || !extent) return this;\n    if (canvas && !this._windy) {\n      this._windy = new Windy({\n        canvas: canvas,\n        data: this.getData(),\n        'onDraw': () => {\n        }\n      });\n      this._windy.start(extent[0], extent[1], extent[2], extent[3]);\n    } else if (canvas && this._windy) {\n      this._windy.start(extent[0], extent[1], extent[2], extent[3]);\n    }\n    // 2D视图时可以省略\n    this._addReFreshHandle();\n    return this;\n  }\n\n  /**\n   * 3D模式下手动刷新\n   * @private\n   */\n  _addReFreshHandle () {\n    const type = this.map.getViewMode_();\n    if (type.toLowerCase() === '3d') {\n      this.layer_ && this.layer_.reFresh();\n      AMap.Util.requestAnimFrame(this._addReFreshHandle);\n    }\n  }\n\n  /**\n   * get canvas layer\n   */\n  getCanvasLayer () {\n    if (!this.canvas && !this.layer_) {\n      const canvas = this.canvasFunction();\n      const bounds = this._getBounds();\n      this.layer_ = new AMap.CanvasLayer({\n        canvas: canvas,\n        bounds: this.options.bounds || bounds,\n        zooms: this.options.zooms || [0, 22],\n        zIndex: this.options.zIndex || 12,\n        opacity: this.options.opacity || 1\n      });\n      this.map.on('mapmove', this.canvasFunction, this);\n      this.map.on('zoomchange', this.canvasFunction, this);\n      this.layer_.setMap(this.map);\n    }\n  }\n\n  /**\n   * canvas constructor\n   * @returns {*}\n   */\n  canvasFunction () {\n    const [width, height] = [this.map.getSize().width, this.map.getSize().height];\n    if (!this.canvas) {\n      this.canvas = createCanvas(width, height, null);\n    } else {\n      this.canvas.width = width;\n      this.canvas.height = height;\n      const bounds = this._getBounds();\n      if (this.layer_) {\n        this.layer_.setBounds(this.options.bounds || bounds);\n      }\n    }\n    this.render(this.canvas);\n    return this.canvas;\n  }\n\n  /**\n   * fixed viewMode\n   * @private\n   */\n  _getBounds () {\n    const type = this.map.getViewMode_();\n    let [southWest, northEast] = [];\n    const bounds = this.map.getBounds()\n    if (type.toLowerCase() === '2d') {\n      northEast = bounds.getNorthEast(); // xmax ymax\n      southWest = bounds.getSouthWest(); // xmin ymin\n    } else {\n      const arrays = bounds.bounds.map(item => {\n        return [item.getLng(), item.getLat()];\n      });\n      const extent = getExtent(arrays);\n      southWest = new AMap.LngLat(extent[0], extent[1]);\n      northEast = new AMap.LngLat(extent[2], extent[3]);\n    }\n    return new AMap.Bounds(southWest, northEast);\n  }\n\n  /**\n   * bounds, width, height, extent\n   * @returns {*}\n   * @private\n   */\n  _getExtent () {\n    const [width, height] = [this.map.getSize().width, this.map.getSize().height];\n    const _ne = this._getBounds().getNorthEast();\n    const _sw = this._getBounds().getSouthWest();\n    return [\n      [[0, 0], [width, height]],\n      width,\n      height,\n      [[_ne.lng, _ne.lat], [_sw.lng, _sw.lat]]\n    ]\n  }\n\n  /**\n   * remove layer\n   */\n  removeLayer () {\n    if (!this.map) return;\n    this.map.removeLayer(this.layer_);\n    this.map.off('resize', this.handleResize, this);\n    this.map.off('mapmove', this.canvasFunction, this);\n    this.map.off('zoomchange', this.canvasFunction, this);\n    delete this.map;\n    delete this.layer_;\n    delete this.canvas;\n  }\n\n  /**\n   * get canvas context\n   * @returns {*}\n   */\n  getContext () {\n    return this.canvas.getContext(this.context);\n  }\n\n  /**\n   * get mouse point data\n   * @param coordinates\n   * @returns {{direction: number, speed: *}}\n   */\n  getPointData (coordinates) {\n    const gridValue = this._windy.interpolatePoint(coordinates[0], coordinates[1]);\n    if (gridValue && !isNaN(gridValue[0]) && !isNaN(gridValue[1]) && gridValue[2]) {\n      return {\n        direction: getDirection(gridValue[0], gridValue[1], this.options.angleConvention || 'bearingCCW'),\n        speed: getSpeed(gridValue[0], gridValue[1], this.options.speedUnit)\n      }\n    }\n  }\n\n  /**\n   * clear wind\n   */\n  clearWind () {\n    if (this._windy) this._windy.stop();\n  }\n}\n\nexport default AMapWind\n"],"names":["Windy","params","projection","MIN_VELOCITY_INTENSITY","minVelocity","MAX_VELOCITY_INTENSITY","maxVelocity","VELOCITY_SCALE","velocityScale","Math","pow","window","devicePixelRatio","MAX_PARTICLE_AGE","particleAge","PARTICLE_LINE_WIDTH","lineWidth","PARTICLE_MULTIPLIER","particleMultiplier","PARTICLE_REDUCTION","FRAME_RATE","frameRate","FRAME_TIME","defaulColorScale","colorScale","NULL_WIND_VECTOR","NaN","builder","grid","gridData","data","date","λ0","φ0","Δλ","Δφ","ni","nj","setData","bilinearInterpolateVector","x","y","g00","g10","g01","g11","rx","ry","a","b","c","d","u","v","sqrt","createWindBuilder","uComp","vComp","uData","vData","header","i","interpolate","createBuilder","forEach","record","parameterCategory","parameterNumber","scalar","buildGrid","callback","lo1","max","la2","la1","dx","dy","nx","ny","Date","refTime","setHours","getHours","forecastTime","p","isContinuous","floor","j","row","push","λ","φ","floorMod","fi","ci","fj","cj","isValue","undefined","n","isMobile","test","navigator","userAgent","distort","scale","wind","windy","distortion","τ","PI","H","hλ","hφ","pλ","project","pφ","k","cos","createField","columns","bounds","field","column","round","release","randomize","o","safetyNet","random","width","height","buildBounds","upperLeft","lowerRight","xMax","min","ceil","yMax","deg2rad","deg","rad2deg","ang","invert","mapLonDelta","east","west","mapLatDelta","south","north","lat","lon","worldMapRadius","mapOffsetY","log","sin","equatorY","atan","exp","mercY","tan","ymin","ymax","xFactor","yFactor","interpolateField","extent","mapArea","interpolateColumn","coord","isFinite","batchInterpolate","start","now","setTimeout","animationLoop","animate","windIntensityColorScale","indexFor","m","length","colorStyles","buckets","map","particleCount","fadeFillStyle","particles","age","evolve","bucket","particle","xt","yt","g","canvas","getContext","fillStyle","globalAlpha","draw","prev","globalCompositeOperation","fillRect","beginPath","strokeStyle","moveTo","lineTo","stroke","then","frame","requestAnimationFrame","delta","updateData","mapBounds","stop","cancelAnimationFrame","shift","w","h","ctx","clamp","high","value","imageData","getImageData","clearRect","putImageData","pLength","update","interpolatePoint","webkitRequestAnimationFrame","mozRequestAnimationFrame","oRequestAnimationFrame","msRequestAnimationFrame","id","clearTimeout","createCanvas","Canvas","document","createElement","getDirection","uMs","vMs","angleConvention","endsWith","abs","velocityAbs","velocityDir","atan2","velocityDirToDegrees","getSpeed","unit","meterSec2kilometerHour","meterSec2Knots","meters","getExtent","coords","Number","POSITIVE_INFINITY","NEGATIVE_INFINITY","reduce","global","AMap","AMapWind","options","layer_","_windy","appendTo","init","bind","handleResize","canvasFunction","_addReFreshHandle","Error","getData","render","context","getCanvasLayer","on","_getExtent","type","getViewMode_","toLowerCase","reFresh","Util","requestAnimFrame","_getBounds","CanvasLayer","zooms","zIndex","opacity","setMap","getSize","setBounds","southWest","northEast","getBounds","getNorthEast","getSouthWest","arrays","item","getLng","getLat","LngLat","Bounds","_ne","_sw","lng","removeLayer","off","getPointData","coordinates","gridValue","isNaN","direction","speed","speedUnit","clearWind"],"mappings":"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"}