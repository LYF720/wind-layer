{"version":3,"file":"BMapWind.common.js","sources":["../src/windy/windy.js","../src/helper/index.js","../src/bmap/index.js"],"sourcesContent":["/* eslint-disable */\r\n\r\n/*  Global class for simulating the movement of particle through a 1km wind grid\r\n credit: All the credit for this work goes to: https://github.com/cambecc for creating the repo:\r\n https://github.com/cambecc/earth. The majority of this code is directly take nfrom there, since its awesome.\r\n This class takes a canvas element and an array of data (1km GFS from http://www.emc.ncep.noaa.gov/index.php?branch=GFS)\r\n and then uses a mercator (forward/reverse) projection to correctly map wind vectors in \"map space\".\r\n The \"start\" method takes the bounds of the map at its current extent and starts the whole gridding,\r\n interpolation and animation process.\r\n */\r\n\r\nconst Windy = function (params = {}) {\r\n  this.params = params;\r\n  const that = this;\r\n\r\n  that.canvas = params.canvas;\r\n\r\n  var defaulColorScale = [\r\n    \"rgb(36,104, 180)\",\r\n    \"rgb(60,157, 194)\",\r\n    \"rgb(128,205,193 )\",\r\n    \"rgb(151,218,168 )\",\r\n    \"rgb(198,231,181)\",\r\n    \"rgb(238,247,217)\",\r\n    \"rgb(255,238,159)\",\r\n    \"rgb(252,217,125)\",\r\n    \"rgb(255,182,100)\",\r\n    \"rgb(252,150,75)\",\r\n    \"rgb(250,112,52)\",\r\n    \"rgb(245,64,32)\",\r\n    \"rgb(237,45,28)\",\r\n    \"rgb(220,24,32)\",\r\n    \"rgb(180,0,35)\"\r\n  ];\r\n\r\n  var buildParams = function(params) {\r\n    if (!params.projection) params.projection = 'EPSG:4326';\r\n    that.MIN_VELOCITY_INTENSITY = params.minVelocity || 0;                      // velocity at which particle intensity is minimum (m/s)\r\n    that.MAX_VELOCITY_INTENSITY = params.maxVelocity || 10;                     // velocity at which particle intensity is maximum (m/s)\r\n    that.VELOCITY_SCALE = (params.velocityScale || 0.005) * (Math.pow(window.devicePixelRatio, 1 / 3) || 1); // scale for wind velocity (completely arbitrary--this value looks nice)\r\n    that.MAX_PARTICLE_AGE = params.particleAge || 90;                         \t // max number of frames a particle is drawn before regeneration\r\n    that.PARTICLE_LINE_WIDTH = params.lineWidth || 1;                           // line width of a drawn particle\r\n    that.PARTICLE_MULTIPLIER = params.particleMultiplier || 1 / 300;            // particle count scalar (completely arbitrary--this values looks nice)\r\n    that.PARTICLE_REDUCTION = (Math.pow(window.devicePixelRatio, 1 / 3) || 1.6);   // multiply particle count for mobiles by this amount\r\n    that.FRAME_RATE = params.frameRate || 16;\r\n    that.COLOR_SCALE = params.colorScale || defaulColorScale;\r\n    that.DEVICEPIXELRATIO = params.devicePixelRatio || 1;\r\n  };\r\n\r\n  buildParams(params);\r\n\r\n  window.FRAME_TIME = 1000 / that.FRAME_RATE;   // desired frames per second\r\n\r\n  var NULL_WIND_VECTOR = [NaN, NaN, null];  // singleton for no wind in the form: [u, v, magnitude]\r\n\r\n  var builder;\r\n  var grid;\r\n  var gridData = that.params.data;\r\n  var date;\r\n  var λ0, φ0, Δλ, Δφ, ni, nj;\r\n\r\n  var setData = function (data) {\r\n    gridData = data;\r\n  };\r\n\r\n  // interpolation for vectors like wind (u,v,m)\r\n  var bilinearInterpolateVector = function (x, y, g00, g10, g01, g11) {\r\n    var rx = (1 - x);\r\n    var ry = (1 - y);\r\n    var a = rx * ry, b = x * ry, c = rx * y, d = x * y;\r\n    var u = g00[0] * a + g10[0] * b + g01[0] * c + g11[0] * d;\r\n    var v = g00[1] * a + g10[1] * b + g01[1] * c + g11[1] * d;\r\n    return [u, v, Math.sqrt(u * u + v * v)];\r\n  };\r\n\r\n\r\n  var createWindBuilder = function (uComp, vComp) {\r\n    var uData = uComp.data, vData = vComp.data;\r\n    return {\r\n      header: uComp.header,\r\n      //recipe: recipeFor(\"wind-\" + uComp.header.surface1Value),\r\n      data: function (i) {\r\n        return [uData[i], vData[i]];\r\n      },\r\n      interpolate: bilinearInterpolateVector\r\n    }\r\n  };\r\n\r\n  var createBuilder = function (data) {\r\n    var uComp = null, vComp = null, scalar = null;\r\n\r\n    data.forEach(function (record) {\r\n      switch (record.header.parameterCategory + \",\" + record.header.parameterNumber) {\r\n        case \"1,2\":\r\n        case \"2,2\":\r\n          uComp = record;\r\n          break;\r\n        case \"1,3\":\r\n        case \"2,3\":\r\n          vComp = record;\r\n          break;\r\n        default:\r\n          scalar = record;\r\n      }\r\n    });\r\n\r\n    return createWindBuilder(uComp, vComp);\r\n  };\r\n\r\n  var buildGrid = function (data, callback) {\r\n\r\n    builder = createBuilder(data);\r\n    var header = builder.header;\r\n\r\n    λ0 = header.lo1;\r\n    φ0 = Math.max(header.la2, header.la1);  // the grid's origin (e.g., 0.0E, 90.0N)\r\n\r\n    Δλ = header.dx;\r\n    Δφ = header.dy;    // distance between grid points (e.g., 2.5 deg lon, 2.5 deg lat)\r\n\r\n    ni = header.nx;\r\n    nj = header.ny;    // number of grid points W-E and N-S (e.g., 144 x 73)\r\n\r\n    date = new Date(header.refTime);\r\n    date.setHours(date.getHours() + header.forecastTime);\r\n\r\n    // Scan mode 0 assumed. Longitude increases from λ0, and latitude decreases from φ0.\r\n    // http://www.nco.ncep.noaa.gov/pmb/docs/grib2/grib2_table3-4.shtml\r\n    grid = [];\r\n    var p = 0;\r\n    var isContinuous = Math.floor(ni * Δλ) >= 360;\r\n\r\n    for (var j = 0; j < nj; j++) {\r\n      var row = [];\r\n      for (var i = 0; i < ni; i++, p++) {\r\n        row[i] = builder.data(p);\r\n      }\r\n      if (isContinuous) {\r\n        // For wrapped grids, duplicate first column as last column to simplify interpolation logic\r\n        row.push(row[0]);\r\n      }\r\n      grid[j] = row;\r\n    }\r\n\r\n    callback({\r\n      date: date,\r\n      interpolate: interpolate\r\n    });\r\n  };\r\n\r\n  /**\r\n   * Get interpolated grid value from Lon/Lat position\r\n   * @param λ {Float} Longitude\r\n   * @param φ {Float} Latitude\r\n   * @returns {Object}\r\n   */\r\n  var interpolate = function (λ, φ) {\r\n\r\n    if (!grid) return null;\r\n\r\n    var i = floorMod(λ - λ0, 360) / Δλ;  // calculate longitude index in wrapped range [0, 360)\r\n    var j = (φ0 - φ) / Δφ;                 // calculate latitude index in direction +90 to -90\r\n\r\n    var fi = Math.floor(i), ci = fi + 1;\r\n    var fj = Math.floor(j), cj = fj + 1;\r\n\r\n    var row;\r\n    if ((row = grid[fj])) {\r\n      var g00 = row[fi];\r\n      var g10 = row[ci];\r\n      if (isValue(g00) && isValue(g10) && (row = grid[cj])) {\r\n        var g01 = row[fi];\r\n        var g11 = row[ci];\r\n        if (isValue(g01) && isValue(g11)) {\r\n          // All four points found, so interpolate the value.\r\n          return builder.interpolate(i - fi, j - fj, g00, g10, g01, g11);\r\n        }\r\n      }\r\n    }\r\n    return null;\r\n  };\r\n\r\n  /**\r\n   * @returns {Boolean} true if the specified value is not null and not undefined.\r\n   */\r\n  var isValue = function (x) {\r\n    return x !== null && x !== undefined;\r\n  };\r\n\r\n  /**\r\n   * @returns {Number} returns remainder of floored division, i.e., floor(a / n). Useful for consistent modulo\r\n   *          of negative numbers. See http://en.wikipedia.org/wiki/Modulo_operation.\r\n   */\r\n  var floorMod = function (a, n) {\r\n    return a - n * Math.floor(a / n);\r\n  };\r\n\r\n  /**\r\n   * @returns {Number} the value x clamped to the range [low, high].\r\n   */\r\n  var clamp = function (x, range) {\r\n    return Math.max(range[0], Math.min(x, range[1]));\r\n  };\r\n\r\n  /**\r\n   * @returns {Boolean} true if agent is probably a mobile device. Don't really care if this is accurate.\r\n   */\r\n  var isMobile = function () {\r\n    return (/android|blackberry|iemobile|ipad|iphone|ipod|opera mini|webos/i).test(navigator.userAgent);\r\n  };\r\n\r\n  /**\r\n   * Calculate distortion of the wind vector caused by the shape of the projection at point (x, y). The wind\r\n   * vector is modified in place and returned by this function.\r\n   */\r\n  var distort = function (projection, λ, φ, x, y, scale, wind, windy) {\r\n    var u = wind[0] * scale;\r\n    var v = wind[1] * scale;\r\n    var d = distortion(projection, λ, φ, x, y, windy);\r\n\r\n    // Scale distortion vectors by u and v, then add.\r\n    wind[0] = d[0] * u + d[2] * v;\r\n    wind[1] = d[1] * u + d[3] * v;\r\n    return wind;\r\n  };\r\n\r\n  var distortion = function (projection, λ, φ, x, y, windy) {\r\n    var τ = 2 * Math.PI;\r\n    // var H = Math.pow(10, -5.2);\r\n    var H = that.params.projection === 'EPSG:4326' ? 5 : Math.pow(10, -5.2);\r\n    var hλ = λ < 0 ? H : -H;\r\n    var hφ = φ < 0 ? H : -H;\r\n\r\n    var pλ = project(φ, λ + hλ, windy);\r\n    var pφ = project(φ + hφ, λ, windy);\r\n\r\n    // Meridian scale factor (see Snyder, equation 4-3), where R = 1. This handles issue where length of 1º λ\r\n    // changes depending on φ. Without this, there is a pinching effect at the poles.\r\n    var k = Math.cos(φ / 360 * τ);\r\n    return [\r\n      (pλ[0] - x) / hλ / k,\r\n      (pλ[1] - y) / hλ / k,\r\n      (pφ[0] - x) / hφ,\r\n      (pφ[1] - y) / hφ\r\n    ];\r\n  };\r\n\r\n  var createField = function (columns, bounds, callback) {\r\n\r\n    /**\r\n     * @returns {Array} wind vector [u, v, magnitude] at the point (x, y), or [NaN, NaN, null] if wind\r\n     *          is undefined at that point.\r\n     */\r\n    function field (x, y) {\r\n      var column = columns[Math.round(x)];\r\n      return column && column[Math.round(y)] || NULL_WIND_VECTOR;\r\n    }\r\n\r\n    // Frees the massive \"columns\" array for GC. Without this, the array is leaked (in Chrome) each time a new\r\n    // field is interpolated because the field closure's context is leaked, for reasons that defy explanation.\r\n    field.release = function () {\r\n      columns = [];\r\n    };\r\n\r\n    field.randomize = function (o) {  // UNDONE: this method is terrible\r\n      var x, y;\r\n      var safetyNet = 0;\r\n      do {\r\n        x = Math.round(Math.floor(Math.random() * bounds.width) + bounds.x);\r\n        y = Math.round(Math.floor(Math.random() * bounds.height) + bounds.y)\r\n      } while (field(x, y)[2] === null && safetyNet++ < 30);\r\n      o.x = x;\r\n      o.y = y;\r\n      return o;\r\n    };\r\n\r\n    callback(bounds, field);\r\n  };\r\n\r\n  var buildBounds = function (bounds, width, height) {\r\n    var upperLeft = bounds[0];\r\n    var lowerRight = bounds[1];\r\n    var x = Math.round(upperLeft[0]); //Math.max(Math.floor(upperLeft[0], 0), 0);\r\n    var y = Math.max(Math.floor(upperLeft[1], 0), 0);\r\n    var xMax = Math.min(Math.ceil(lowerRight[0], width), width - 1);\r\n    var yMax = Math.min(Math.ceil(lowerRight[1], height), height - 1);\r\n    return {x: x, y: y, xMax: width, yMax: yMax, width: width, height: height};\r\n  };\r\n\r\n  var deg2rad = function (deg) {\r\n    return (deg / 180) * Math.PI;\r\n  };\r\n\r\n  var rad2deg = function (ang) {\r\n    return ang / (Math.PI / 180.0);\r\n  };\r\n\r\n  var invert\r\n\r\n  if (that.params.projection === 'EPSG:4326') {\r\n    invert = function (x, y, windy) {\r\n      var mapLonDelta = windy.east - windy.west;\r\n      var mapLatDelta = windy.south - windy.north;\r\n      var lat = rad2deg(windy.north) + y / windy.height * rad2deg(mapLatDelta);\r\n      var lon = rad2deg(windy.west) + x / windy.width * rad2deg(mapLonDelta);\r\n      return [lon, lat];\r\n    };\r\n  } else {\r\n    invert = function (x, y, windy) {\r\n      var mapLonDelta = windy.east - windy.west;\r\n      var worldMapRadius = windy.width / rad2deg(mapLonDelta) * 360 / (2 * Math.PI);\r\n      var mapOffsetY = (worldMapRadius / 2 * Math.log((1 + Math.sin(windy.south)) / (1 - Math.sin(windy.south))));\r\n      var equatorY = windy.height + mapOffsetY;\r\n      var a = (equatorY - y) / worldMapRadius;\r\n      var lat = 180 / Math.PI * (2 * Math.atan(Math.exp(a)) - Math.PI / 2);\r\n      var lon = rad2deg(windy.west) + x / windy.width * rad2deg(mapLonDelta);\r\n      return [lon, lat];\r\n    };\r\n  }\r\n\r\n  var mercY = function (lat) {\r\n    return Math.log(Math.tan(lat / 2 + Math.PI / 4));\r\n  };\r\n\r\n\r\n  var project = function (lat, lon, windy) { // both in radians, use deg2rad if neccessary\r\n    var ymin = mercY(windy.south);\r\n    var ymax = mercY(windy.north);\r\n    var xFactor = windy.width / (windy.east - windy.west);\r\n    var yFactor = windy.height / (ymax - ymin);\r\n\r\n    var y = mercY(deg2rad(lat));\r\n    var x = (deg2rad(lon) - windy.west) * xFactor;\r\n    var y = (ymax - y) * yFactor; // y points south\r\n    return [x, y];\r\n  };\r\n\r\n  var interpolateField = function (grid, bounds, extent, callback) {\r\n\r\n    var projection = {};\r\n    var mapArea = ((extent.south - extent.north) * (extent.west - extent.east));\r\n    var velocityScale = that.VELOCITY_SCALE * Math.pow(mapArea, 0.4);\r\n\r\n    var columns = [];\r\n    var x = bounds.x;\r\n\r\n    function interpolateColumn (x) {\r\n      var column = [];\r\n      for (var y = bounds.y; y <= bounds.yMax; y += 2) {\r\n        var coord = invert(x, y, extent);\r\n        if (coord) {\r\n          var λ = coord[0], φ = coord[1];\r\n          if (isFinite(λ)) {\r\n            var wind = grid.interpolate(λ, φ);\r\n            if (wind) {\r\n              wind = distort(projection, λ, φ, x, y, velocityScale, wind, extent);\r\n              column[y + 1] = column[y] = wind;\r\n\r\n            }\r\n          }\r\n        }\r\n      }\r\n      columns[x + 1] = columns[x] = column;\r\n    }\r\n\r\n    (function batchInterpolate () {\r\n      var start = Date.now();\r\n      while (x < bounds.width) {\r\n        interpolateColumn(x);\r\n        x += 2;\r\n        if ((Date.now() - start) > 1000) { //MAX_TASK_TIME) {\r\n          setTimeout(batchInterpolate, 25);\r\n          return;\r\n        }\r\n      }\r\n      createField(columns, bounds, callback);\r\n    })();\r\n  };\r\n\r\n  var animationLoop;\r\n  var animate = function (bounds, field) {\r\n\r\n    function windIntensityColorScale (min, max) {\r\n\r\n      that.COLOR_SCALE.indexFor = function (m) {  // map velocity speed to a style\r\n        return Math.max(0, Math.min((that.COLOR_SCALE.length - 1),\r\n          Math.round((m - min) / (max - min) * (that.COLOR_SCALE.length - 1))));\r\n\r\n      };\r\n\r\n      return that.COLOR_SCALE;\r\n    }\r\n\r\n    var colorStyles = windIntensityColorScale(that.MIN_VELOCITY_INTENSITY, that.MAX_VELOCITY_INTENSITY);\r\n    var buckets = colorStyles.map(function () {\r\n      return [];\r\n    });\r\n\r\n    var particleCount = Math.round(bounds.width * bounds.height * that.PARTICLE_MULTIPLIER);\r\n    if (isMobile()) {\r\n      particleCount *= that.PARTICLE_REDUCTION;\r\n    }\r\n\r\n    var fadeFillStyle = \"rgba(0, 0, 0, 0.97)\";\r\n\r\n    var particles = [];\r\n    for (var i = 0; i < particleCount; i++) {\r\n      particles.push(field.randomize({age: Math.floor(Math.random() * that.MAX_PARTICLE_AGE) + 0}));\r\n    }\r\n\r\n    function evolve () {\r\n      buckets.forEach(function (bucket) {\r\n        bucket.length = 0;\r\n      });\r\n      particles.forEach(function (particle) {\r\n        if (particle.age > that.MAX_PARTICLE_AGE) {\r\n          field.randomize(particle).age = 0;\r\n        }\r\n        var x = particle.x;\r\n        var y = particle.y;\r\n        var v = field(x, y);  // vector at current position\r\n        var m = v[2];\r\n        if (m === null) {\r\n          particle.age = that.MAX_PARTICLE_AGE;  // particle has escaped the grid, never to return...\r\n        }\r\n        else {\r\n          var xt = x + v[0];\r\n          var yt = y + v[1];\r\n          if (field(xt, yt)[2] !== null) {\r\n            // Path from (x,y) to (xt,yt) is visible, so add this particle to the appropriate draw bucket.\r\n            particle.xt = xt;\r\n            particle.yt = yt;\r\n            buckets[colorStyles.indexFor(m)].push(particle);\r\n          } else {\r\n            // Particle isn't visible, but it still moves through the field.\r\n            particle.x = xt;\r\n            particle.y = yt;\r\n          }\r\n        }\r\n        particle.age += 1;\r\n      });\r\n    }\r\n\r\n    var g = that.canvas.getContext(\"2d\");\r\n    g.lineWidth = that.PARTICLE_LINE_WIDTH;\r\n    g.fillStyle = fadeFillStyle;\r\n    g.globalAlpha = 0.6;\r\n\r\n    function draw () {\r\n      // Fade existing particle trails.\r\n      var prev = \"lighter\";\r\n      g.globalCompositeOperation = \"destination-in\";\r\n      g.fillRect(bounds.x, bounds.y, that.canvas.width, that.canvas.height);\r\n      g.globalCompositeOperation = prev;\r\n      g.globalAlpha = 0.9;\r\n\r\n      // Draw new particle trails.\r\n      buckets.forEach(function (bucket, i) {\r\n        if (bucket.length > 0) {\r\n          g.beginPath();\r\n          g.strokeStyle = colorStyles[i];\r\n          bucket.forEach(function (particle) {\r\n            g.moveTo(particle.x * that.DEVICEPIXELRATIO, particle.y * that.DEVICEPIXELRATIO);\r\n            g.lineTo(particle.xt * that.DEVICEPIXELRATIO, particle.yt * that.DEVICEPIXELRATIO);\r\n            particle.x = particle.xt;\r\n            particle.y = particle.yt;\r\n          });\r\n          g.stroke();\r\n        }\r\n      });\r\n    }\r\n\r\n    var then = Date.now();\r\n    (function frame () {\r\n      animationLoop = requestAnimationFrame(frame);\r\n      var now = Date.now();\r\n      var delta = now - then;\r\n      if (delta > FRAME_TIME) {\r\n        then = now - (delta % FRAME_TIME);\r\n        evolve();\r\n        draw();\r\n        params.onDraw && params.onDraw();\r\n      }\r\n    })();\r\n  };\r\n\r\n  var updateData = function (data, bounds, width, height, extent) {\r\n    delete that.params.data;\r\n    that.params.data = data;\r\n    if (extent)\r\n      start(bounds, width, height, extent);\r\n  };\r\n\r\n  var start = function (bounds, width, height, extent) {\r\n    var mapBounds = {\r\n      south: deg2rad(extent[0][1]),\r\n      north: deg2rad(extent[1][1]),\r\n      east: deg2rad(extent[1][0]),\r\n      west: deg2rad(extent[0][0]),\r\n      width: width,\r\n      height: height\r\n    };\r\n\r\n    stop();\r\n\r\n    // build grid\r\n    buildGrid(gridData, function (grid) {\r\n      // interpolateField\r\n      interpolateField(grid, buildBounds(bounds, width, height), mapBounds, function (bounds, field) {\r\n        // animate the canvas with random points\r\n        windy.field = field;\r\n        animate(bounds, field);\r\n      });\r\n\r\n    });\r\n  };\r\n\r\n  var stop = function () {\r\n    if (windy.field) windy.field.release();\r\n    if (animationLoop) cancelAnimationFrame(animationLoop);\r\n  };\r\n\r\n  var shift = function (dx, dy) {\r\n    var canvas = that.canvas, w = canvas.width, h = canvas.height, ctx = canvas.getContext(\"2d\");\r\n    if (w > dx && h > dy) {\r\n      var clamp = function (high, value) {\r\n        return Math.max(0, Math.min(high, value));\r\n      };\r\n      var imageData = ctx.getImageData(clamp(w, -dx), clamp(h, -dy), clamp(w, w - dx), clamp(h, h - dy));\r\n      ctx.clearRect(0, 0, w, h);\r\n      ctx.putImageData(imageData, clamp(w, dx), clamp(h, dy));\r\n      for (var i = 0, pLength = particles.length; i < pLength; i++) {\r\n        particles[i].x += dx;\r\n        particles[i].y += dy;\r\n      }\r\n    }\r\n  };\r\n\r\n  var updateParams = function(params) {\r\n    that.params = params;\r\n    buildParams(that.params);\r\n  };\r\n\r\n  var getParams = function() {\r\n    return that.params;\r\n  };\r\n\r\n  var windy = {\r\n    params: that.params,\r\n    start: start,\r\n    stop: stop,\r\n    update: updateData,\r\n    shift: shift,\r\n    createField: createField,\r\n    interpolatePoint: interpolate,\r\n    setData: setData,\r\n    updateParams: updateParams,\r\n    getParams: getParams,\r\n    buildParams: buildParams,\r\n  };\r\n\r\n  return windy;\r\n};\r\n\r\n// polyfill\r\nwindow.requestAnimationFrame = (function () {\r\n  return window.requestAnimationFrame ||\r\n    window.webkitRequestAnimationFrame ||\r\n    window.mozRequestAnimationFrame ||\r\n    window.oRequestAnimationFrame ||\r\n    window.msRequestAnimationFrame ||\r\n    function (callback) {\r\n      return window.setTimeout(callback, 1000 / window.FRAME_RATE);\r\n    };\r\n})();\r\n\r\nif (!window.cancelAnimationFrame) {\r\n  window.cancelAnimationFrame = function (id) {\r\n    clearTimeout(id);\r\n  };\r\n}\r\n\r\nexport default Windy\r\n","/**\r\n * create canvas\r\n * @param width\r\n * @param height\r\n * @param Canvas\r\n * @returns {HTMLCanvasElement}\r\n */\r\nconst createCanvas = (width, height, Canvas) => {\r\n  if (typeof document !== 'undefined') {\r\n    const canvas = document.createElement('canvas');\r\n    canvas.width = width;\r\n    canvas.height = height;\r\n    return canvas\r\n  } else {\r\n    // create a new canvas instance in node.js\r\n    // the canvas class needs to have a default constructor without any parameter\r\n    return new Canvas(width, height);\r\n  }\r\n};\r\n\r\nconst getDirection = (uMs, vMs, angleConvention) => {\r\n  // Default angle convention is CW\r\n  if (angleConvention.endsWith('CCW')) {\r\n    // vMs comes out upside-down..\r\n    vMs = vMs > 0 ? vMs = -vMs : Math.abs(vMs);\r\n  }\r\n  const velocityAbs = Math.sqrt(Math.pow(uMs, 2) + Math.pow(vMs, 2));\r\n  const velocityDir = Math.atan2(uMs / velocityAbs, vMs / velocityAbs);\r\n  let velocityDirToDegrees = velocityDir * 180 / Math.PI + 180;\r\n  if (angleConvention === 'bearingCW' || angleConvention === 'meteoCCW') {\r\n    velocityDirToDegrees += 180;\r\n    if (velocityDirToDegrees >= 360) velocityDirToDegrees -= 360;\r\n  }\r\n  return velocityDirToDegrees;\r\n};\r\n\r\nconst getSpeed = (uMs, vMs, unit) => {\r\n  const velocityAbs = Math.sqrt(Math.pow(uMs, 2) + Math.pow(vMs, 2));\r\n  // Default is m/s\r\n  if (unit === 'k/h') {\r\n    return meterSec2kilometerHour(velocityAbs);\r\n  } else if (unit === 'kt') {\r\n    return meterSec2Knots(velocityAbs);\r\n  } else {\r\n    return velocityAbs;\r\n  }\r\n};\r\n\r\nconst meterSec2Knots = (meters) => {\r\n  return meters / 0.514\r\n};\r\n\r\nconst meterSec2kilometerHour = (meters) => {\r\n  return meters * 3.6\r\n};\r\n\r\nconst getExtent = (coords) => {\r\n  const extent = [\r\n    Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY,\r\n    Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY\r\n  ];\r\n  return coords.reduce((prev, coord) => {\r\n    return [\r\n      Math.min(coord[0], prev[0]),\r\n      Math.min(coord[1], prev[1]),\r\n      Math.max(coord[0], prev[2]),\r\n      Math.max(coord[1], prev[3])\r\n    ];\r\n  }, extent);\r\n}\r\n\r\nexport {\r\n  getExtent,\r\n  getSpeed,\r\n  createCanvas,\r\n  getDirection\r\n}\r\n","import Windy from '../windy/windy';\r\nimport { getDirection, getSpeed } from '../helper';\r\n\r\nconst global = typeof window === 'undefined' ? {} : window;\r\n\r\nif (!global.BMap) global.BMap = {};\r\n\r\nif (!global.BMap.Overlay) global.BMap.Overlay = class Overlay {};\r\n\r\nclass BaiduWind extends global.BMap.Overlay {\r\n  constructor (data, options = {}) {\r\n    super(options);\r\n    this.options = options;\r\n    this.paneName = this.options.paneName || 'mapPane';\r\n    this.context = this.options.context || '2d';\r\n    this.zIndex = this.options.zIndex || 0;\r\n    this.mixBlendMode = this.options.mixBlendMode || null;\r\n    this.enableMassClear = this.options.enableMassClear;\r\n    this._map = options.map;\r\n    this._lastDrawTime = null;\r\n\r\n    /**\r\n     * 矢量图层\r\n     * @type {null}\r\n     */\r\n    this.canvas = null;\r\n\r\n    /**\r\n     * windy 数据\r\n     */\r\n    this.data = data;\r\n\r\n    /**\r\n     * windy layer\r\n     * @type {null}\r\n     */\r\n    this._windy = null;\r\n    this.show();\r\n  }\r\n\r\n  /**\r\n   * get layer data\r\n   * @returns {*}\r\n   */\r\n  getData () {\r\n    return this.data;\r\n  }\r\n\r\n  /**\r\n   * set data\r\n   * @param data\r\n   */\r\n  setData (data) {\r\n    this.data = data;\r\n    if (this._map && this.data) {\r\n      this._draw();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * bounds, width, height, extent\r\n   * @returns {*}\r\n   * @private\r\n   */\r\n  _getExtent () {\r\n    const size = this._map.getSize();\r\n    const _ne = this._map.getBounds().getNorthEast();\r\n    const _sw = this._map.getBounds().getSouthWest();\r\n    return [\r\n      [\r\n        [0, 0], [size.width, size.height]\r\n      ],\r\n      size.width,\r\n      size.height,\r\n      [\r\n        // [_ne.lng, _ne.lat], [_sw.lng, _sw.lat]\r\n        [_sw.lng, _sw.lat], [_ne.lng, _ne.lat] // [xmin, ymin, xmax, ymax]: 西南 和 东北\r\n      ]\r\n    ]\r\n  }\r\n\r\n  /**\r\n   * append layer to map\r\n   * @param map\r\n   */\r\n  appendTo (map) {\r\n    if (map) {\r\n      map.addOverlay(this);\r\n    } else {\r\n      throw new Error('not map object');\r\n    }\r\n  }\r\n\r\n  initialize (map) {\r\n    this._map = map;\r\n    const canvas = this.canvas = document.createElement('canvas');\r\n    canvas.style.cssText = `position:absolute; left:0; top:0; z-index: ${this.zIndex} ;user-select:none;`;\r\n    canvas.style.mixBlendMode = this.mixBlendMode;\r\n    this.adjustSize();\r\n    map.getPanes()[this.paneName].appendChild(canvas);\r\n    map.addEventListener('resize', () => {\r\n      this.adjustSize();\r\n      this._draw();\r\n    });\r\n    return this.canvas\r\n  }\r\n\r\n  adjustSize () {\r\n    const size = this._map.getSize();\r\n    const canvas = this.canvas;\r\n    const devicePixelRatio = this.devicePixelRatio = global.devicePixelRatio || 1;\r\n    canvas.width = size.width * devicePixelRatio;\r\n    canvas.height = size.height * devicePixelRatio;\r\n    if (this.context === '2d') {\r\n      canvas.getContext(this.context).scale(devicePixelRatio, devicePixelRatio)\r\n    }\r\n    canvas.style.width = size.width + 'px';\r\n    canvas.style.height = size.height + 'px';\r\n  }\r\n\r\n  draw () {\r\n    const self = this;\r\n    clearTimeout(self.timeoutID);\r\n    self.timeoutID = setTimeout(function () {\r\n      self._draw()\r\n    }, 15);\r\n  }\r\n\r\n  _draw () {\r\n    const map = this._map;\r\n    const size = map.getSize();\r\n    const center = map.getCenter();\r\n    if (center) {\r\n      const pixel = map.pointToOverlayPixel(center);\r\n      this.canvas.style.left = pixel.x - size.width / 2 + 'px';\r\n      this.canvas.style.top = pixel.y - size.height / 2 + 'px';\r\n      this.dispatchEvent('draw');\r\n      this.options.update && this.options.update.call(this);\r\n      this.render(this.canvas);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * render windy layer\r\n   * @param canvas\r\n   * @returns {BaiduWind}\r\n   */\r\n  render (canvas) {\r\n    const extent = this._getExtent();\r\n    if (!this.getData() || !extent) return this;\r\n    if (canvas && !this._windy) {\r\n      const {\r\n        minVelocity,\r\n        maxVelocity,\r\n        velocityScale,\r\n        particleAge,\r\n        lineWidth,\r\n        particleMultiplier,\r\n        colorScale\r\n      } = this.options;\r\n      this._windy = new Windy({\r\n        canvas: canvas,\r\n        data: this.getData(),\r\n        'onDraw': () => {\r\n        },\r\n        minVelocity,\r\n        maxVelocity,\r\n        velocityScale,\r\n        particleAge,\r\n        lineWidth,\r\n        particleMultiplier,\r\n        colorScale\r\n      });\r\n      this._windy.start(extent[0], extent[1], extent[2], extent[3]);\r\n    } else if (canvas && this._windy) {\r\n      this._windy.start(extent[0], extent[1], extent[2], extent[3]);\r\n    }\r\n    return this;\r\n  }\r\n\r\n  getContainer () {\r\n    return this.canvas;\r\n  }\r\n\r\n  setZIndex (zIndex) {\r\n    this.zIndex = zIndex;\r\n    this.canvas.style.zIndex = this.zIndex;\r\n  }\r\n\r\n  getZIndex () {\r\n    return this.zIndex;\r\n  }\r\n\r\n  /**\r\n   * get mouse point data\r\n   * @param coordinates\r\n   * @returns {{direction: number, speed: *}}\r\n   */\r\n  getPointData (coordinates) {\r\n    const gridValue = this._windy.interpolatePoint(coordinates[0], coordinates[1]);\r\n    if (gridValue && !isNaN(gridValue[0]) && !isNaN(gridValue[1]) && gridValue[2]) {\r\n      return {\r\n        direction: getDirection(gridValue[0], gridValue[1], this.options.angleConvention || 'bearingCCW'),\r\n        speed: getSpeed(gridValue[0], gridValue[1], this.options.speedUnit)\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * clear wind\r\n   */\r\n  clearWind () {\r\n    if (this._windy) this._windy.stop();\r\n  }\r\n\r\n  /**\r\n   * update windy config\r\n   * @param params\r\n   * @returns {BaiduWind}\r\n   */\r\n  updateParams (params) {\r\n    this.options = Object.assign(this.options, params);\r\n    if (this._windy) {\r\n      const {\r\n        minVelocity, // 粒子强度最小的速度 (m/s)\r\n        maxVelocity, // 粒子强度最大的速度 (m/s)\r\n        velocityScale, // 风速的比例\r\n        particleAge, // 重绘之前生成的离子数量的最大帧数\r\n        lineWidth, // 绘制粒子的线宽\r\n        particleMultiplier, // 离子数量\r\n        colorScale\r\n      } = this.options;\r\n      if (this._windy) {\r\n        // this._windy.stop();\r\n        this._windy.updateParams({\r\n          minVelocity,\r\n          maxVelocity,\r\n          velocityScale,\r\n          particleAge,\r\n          lineWidth,\r\n          particleMultiplier,\r\n          colorScale\r\n        });\r\n        if (this._map && this.canvas && this.data) {\r\n          this.render(this.canvas);\r\n        }\r\n      }\r\n    }\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * get windy config\r\n   * @returns {null|*|Windy.params|{velocityScale, minVelocity, maxVelocity, colorScale, particleAge, lineWidth, particleMultiplier}}\r\n   */\r\n  getParams () {\r\n    return this._windy && this._windy.getParams();\r\n  }\r\n}\r\n\r\nexport default BaiduWind;\r\n"],"names":["const","let","super","this"],"mappings":"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"}